<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Test Form</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <style>
        .api-key-field {
            width:330px;
        }
        input {
            margin-bottom: 6px;
            margin-left: 6px;
            margin-right: 6px;
        }
        .desc {
            font-size: 10pt;
            color: rgb(167, 167, 167);
            font-style: italic;
        }
    </style>
</head>
<body>
    <form>
        <fieldset style="float: left; margin-right: 8px;">
            <legend>Server</legend>
            <label>Host:<input id="host" type="text" value="http://"/></label><br/>
            <label>Port:<input id="port" type="text"/></label><br/>
        </fieldset>
        <fieldset style="float: left; margin-right: 8px;">
            <legend>Generate API key / Register owner</legend>
            <label>Email:<input style="width: 250px;" id="owner-email" type="text"/></label><br/>
            <input id="gen-api-key" type="button" value="Generate API key"/>
        </fieldset>
        <fieldset class="area-of-delete-game">
            <legend>Delete game</legend>
            <label>API key:<input class="api-key-field" type="text"/></label><br/>
            <input id="del-game" type="button" value="Delete game"/>
        </fieldset>
        <br/>
        <fieldset style="float: left; margin-right: 8px;" class="reg-game-area">
            <legend>Register game</legend>
            <label>API key:<input class="api-key-field" type="text"/></label><br/>
            <label>Game name:<input class="game-name-field" type="text"/></label><br/>
            <label>Game package:<input class="game-package-field" type="text"/></label><br/>
            <label>Game type:<input class="game-type-field" type="text"/></label><br/>
            <input id="reg-game" type="button" value="Register game"/><span class="desc">Register game and create tables "players", "scorelevel", "boosts"</span>
        </fieldset>
        <fieldset class="area-of-select">
            <legend>Select data</legend>
            <label>API key:<input class="api-key-field" type="text"/></label><br/>
            <label>Player id:<input class="player-id-field" type="text"/></label><br/>
            <label>Table:<input class="table-field" type="text"/></label><br/>
            <label>Where:<input class="data-field" type="text"/></label><span class="desc">param1=valueA&amp;param2=valueB</span><br/>
            <input id="select" type="button" value="Request"/>
        </fieldset>
        <br/>
        <fieldset style="float: left; margin-right: 8px;" class="area-of-insert">
            <legend>Insert data</legend>
            <label>API key:<input class="api-key-field" type="text"/></label><br/>
            <label>Player id:<input class="player-id-field" type="text"/></label><br/>
            <label>Table:<input class="table-field" type="text"/></label><br/>
            <label>Data:<input class="data-field" type="text"/></label><span class="desc">param1=valueA&amp;param2=valueB</span><br/>
            <input id="insert" type="button" value="Send"/>
        </fieldset>
        <fieldset class="area-of-update">
            <legend>Update data</legend>
            <label>API key:<input class="api-key-field" type="text"/></label><br/>
            <label>Player id:<input class="player-id-field" type="text"/></label><br/>
            <label>Table:<input class="table-field" type="text"/></label><br/>
            <label>Set:<input class="data-field" type="text"/></label><span class="desc">param1=valueA&amp;param2=valueB</span>
            <label>Where:<input class="where-field"/></label><span class="desc">param1=valueA&amp;param2=valueB</span><br/>
            <input id="update" type="button" value="Send"/>
        </fieldset>
        <br/>
        <label>Response:</label><br/><textarea name="" id="response-area" cols="30" rows="10"></textarea>
    </form>
    <script>
            function sendAjax(url, postData) {
                /*$.post(url, postData, 
                    function(returnedData){
                        console.log(returnedData);
                        $("#response-area").text(returnedData);
                });*/
                //alert(JSON.stringify(postData));
                $.ajax({
                    url: url,
                    type: "POST",
                    crossDomain: true,
                    data: postData,
                    //dataType: "json",
                    success: function (response) {
                        //var resp = JSON.parse(response)
                        //alert(resp.status);
                        //console.log(response);
                        $("#response-area").text(JSON.stringify(response));
                    },
                    error: function (xhr, status) {
                        alert("error "+status);
                    }
                });
            }
    
            $('#gen-api-key').on('click', function() {
                sendAjax($("#host").val()+":"+$("#port").val()+"/system/generate_api_key?email="+$('#owner-email').val(), {});
            });
    
            $('#reg-game').on('click', function() {
                sendAjax($("#host").val()+":"+$("#port").val()+"/system/register_game", "api_key="+$('.reg-game-area .api-key-field').val()+ 
                                                                                         "&game_name="+$('.reg-game-area .game-name-field').val()+ 
                                                                                         "&game_package="+$('.reg-game-area .game-package-field').val()+ 
                                                                                         "&game_type="+$('.reg-game-area .game-type-field').val());
            });
    
            $('#del-game').on('click', function() {
                sendAjax($("#host").val()+":"+$("#port").val()+"/system/delete_game?api_key="+$('.area-of-delete-game .api-key-field').val(), {});
            });
    
            $('#insert').on('click', function() {
                sendAjax($("#host").val()+":"+$("#port").val()+"/api/insert?api_key="+$('.area-of-insert .api-key-field').val()+"&player_id="+$('.area-of-insert .player-id-field').val()+"&table="+$('.area-of-insert .table-field').val(), 
                JSON.stringify(dataToJson($('.area-of-insert .data-field').val())));
            });
    
            $('#select').on('click', function() {
                sendAjax($("#host").val()+":"+$("#port").val()+"/api/select?api_key="+$('.area-of-select .api-key-field').val()+"&player_id="+$('.area-of-select .player-id-field').val()+"&table="+$('.area-of-select .table-field').val(), 
                JSON.stringify(dataToJson($('.area-of-select .data-field').val())));
            });
    
            $('#update').on('click', function() {
                sendAjax($("#host").val()+":"+$("#port").val()+"/api/update?api_key="+$('.area-of-update .api-key-field').val()+"&player_id="+$('.area-of-update .player-id-field').val()+"&table="+$('.area-of-update .table-field').val(), 
                JSON.stringify({set : dataToJson($('.area-of-update .data-field').val()), where : dataToJson($('.area-of-update .where-field').val())}));
            });

            function dataToJson(data) {
                var result = [];
                if(data.includes("&")) {
                    var array1 = data.split("&");
                    array1.forEach(function(item) {
                        var array2 = item.split("=");
                        result.push({name : array2[0], value : array2[1]});
                    });
                } else {
                    var array2 = data.split("=");
                    result.push({name : array2[0], value : array2[1]});
                }
                
              return result;  
            }
        </script>
</body>
</html>