<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Test Form</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <style>
        .api-key-field {
            width:330px;
        }
        input {
            margin-bottom: 6px;
            margin-left: 6px;
            margin-right: 6px;
        }
        .desc {
            font-size: 10pt;
            color: rgb(167, 167, 167);
            font-style: italic;
        }
    </style>
</head>
<body>
    <form>
        <fieldset style="float: left; margin-right: 8px; height:100px;">
            <legend>Server</legend>
            <label>Host:<input id="host" type="text" value="http://"/></label><br/>
            <label>Port:<input id="port" type="text"/></label><br/>
        </fieldset>
        <fieldset style="float: left; margin-right: 8px;">
            <legend>Generate API key / Register owner</legend>
            <label>Email:<input style="width: 250px;" id="owner-email" type="text"/></label><br/>
            <input id="gen-api-key" type="button" value="Generate API key"/><br/>
            <input class="clear-fields" type="button" value="Clear fileds"/>
        </fieldset>
        <fieldset class="area-of-delete-game">
            <legend>Delete game</legend>
            <label>API key:<input class="api-key-field" type="text"/></label><br/>
            <input id="del-game" type="button" value="Delete game"/><br/>
            <input class="clear-fields" type="button" value="Clear fileds"/>
        </fieldset>
        <fieldset class="reg-game-area">
            <legend>Register game</legend>
            <label>API key:<input class="api-key-field" type="text"/></label><br/>
            <label>Game name:<input class="game-name-field" type="text"/></label><br/>
            <label>Game package:<input class="game-package-field" type="text"/></label><br/>
            <label>Game type:<input class="game-type-field" type="text"/></label><br/>
            <input id="fill-test-data" type="button" value="Fill test data"/><br/>
            <input id="reg-game" type="button" value="Register game"/><span class="desc">Register game and create tables "players", "scorelevel", "boosts"</span><br/>
            <input class="clear-fields" type="button" value="Clear fileds"/>
        </fieldset>
        <fieldset style="float: left; margin-right: 8px;" class="area-of-select">
            <legend>Select data</legend>
            <label>API key:<input class="api-key-field" type="text"/></label><br/>
            <label>Table:<input class="table-field" type="text"/></label><br/>
            <label>Where:<input class="data-field" type="text"/></label><span class="desc">param1=valueA&amp;param2=valueB</span><br/>
            <input id="select" type="button" value="Request"/><br/>
            <input class="clear-fields" type="button" value="Clear fileds"/>
        </fieldset>
        <fieldset style="float: left; margin-right: 8px;" class="area-of-insert">
            <legend>Insert data</legend>
            <label>API key:<input class="api-key-field" type="text"/></label><br/>
            <label>Table:<input class="table-field" type="text"/></label><br/>
            <label>Data:<input class="data-field" type="text"/></label><span class="desc">param1=valueA&amp;param2=valueB</span><br/>
            <input id="update-if-exists" type="checkbox" value=""/>Update if exists<br/>
            <span style="display:none" id="check-fields-label"><label>Check fields:<input id="check-fields" type="text"/></label><span class="desc">fieldName1,fieldName2,fieldName3</span></span><br/>
            <input id="insert" type="button" value="Send"/><br/>
            <input class="clear-fields" type="button" value="Clear fileds"/>
        </fieldset>
        <fieldset class="area-of-update">
            <legend>Update data</legend>
            <label>API key:<input class="api-key-field" type="text"/></label><br/>
            <label>Table:<input class="table-field" type="text"/></label><br/>
            <label>Set:<input class="data-field" type="text"/></label><span class="desc">param1=valueA&amp;param2=valueB</span><br/>
            <label>Where:<input class="where-field"/></label><span class="desc">param1=valueA&amp;param2=valueB</span><br/>
            <input id="update" type="button" value="Send"/><br/>
            <input class="clear-fields" type="button" value="Clear fileds"/>
        </fieldset>
        <br/>
        <label>Response:</label><br/><textarea name="" id="response-area" cols="30" rows="10"></textarea>
    </form>
    <b>Generate API key / Register owner:</b><br/>
    https://candy-smith.info:3636/system/generate_api_key?email=fake@fake.net<br/><br/><br/>
    
    <b>Register game:</b><br/>
    https://candy-smith.info:3636/system/register_game<br/>
    <span style="color: rgb(28, 143, 85);">Эти данные отправляются в теле POST запроса:</span><br/>
    api_key=348t7hre48eruif78e74g4&game_name=Magic Forest&game_package=com.magicgames.magicforest&game_type=assetname<br/><br/>
    
    <b>Delete game:</b><br/>
    https://candy-smith.info:3636/system/delete_game?api_key=348t7hre48eruif78e74g4<br/><br/><br/>

    <b>Insert data:</b><br/>
    https://candy-smith.info:3636/api/insert?api_key=348t7hre48eruif78e74g4&player_id=123456&table=tablename<br/><br/>

    <span style="color: rgb(28, 143, 85);">Эти данные отправляются в теле POST запроса. В данном примере отправляются 2 строки данных.</span><br/>
    [<br/>&emsp;
        [<br/>&emsp;&emsp;
            {<br/>&emsp;&emsp;&emsp;
                type : "INTEGER",<span style="color: rgb(28, 143, 85);">&emsp;&emsp;&emsp;&emsp;&lt;-- Параметр type не обязательный, так как работает автоматическое приведение типов</span><br/>&emsp;&emsp;&emsp; 
                name : "field_name1",<br/>&emsp;&emsp;&emsp;
                value : 3050<br/>&emsp;&emsp;
            },<br/>&emsp;&emsp;
            {<br/>&emsp;&emsp;&emsp;
                type : "FLOAT",<br/>&emsp;&emsp;&emsp;
                name : "field_name2",<br/>&emsp;&emsp;&emsp;
                value : 7.55<br/>&emsp;&emsp;
            },<br/>&emsp;&emsp;
            {<br/>&emsp;&emsp;&emsp;
                type : "STRING",<br/>&emsp;&emsp;&emsp;
                name : "field_name3",<br/>&emsp;&emsp;&emsp;
                value : "hahaha"<br/>&emsp;&emsp;
            }<br/>&emsp;
        ],<br/>&emsp;
        [<br/>&emsp;&emsp;
            {<br/>&emsp;&emsp;&emsp;
                type : "INTEGER",<br/>&emsp;&emsp;&emsp;
                name : "field_name1",<br/>&emsp;&emsp;&emsp;
                value : 3300<br/>&emsp;&emsp;
            },<br/>&emsp;&emsp;
            {<br/>&emsp;&emsp;&emsp;
                type : "FLOAT",<br/>&emsp;&emsp;&emsp;
                name : "field_name2",<br/>&emsp;&emsp;&emsp;
                value : 8.0<br/>&emsp;&emsp;
            },<br/>&emsp;&emsp;
            {<br/>&emsp;&emsp;&emsp;
                type : "STRING",<br/>&emsp;&emsp;&emsp;
                name : "field_name3",<br/>&emsp;&emsp;&emsp;
                value : "what?"<br/>&emsp;&emsp;
            }<br/>&emsp;
        ]<br/>
    ]<br/><br/><br/>
    
    <b>Select data:</b><br/>
    https://candy-smith.info:3636/api/select?api_key=348t7hre48eruif78e74g4&player_id=123456&table=tablename<br/><br/>
    <span style="color: rgb(28, 143, 85);">Условие WHERE, SQL запроса, ревращается в field_name1=330 AND field_name2=8.0 AND field_name3='what?'</span><br/>
    [<br/>&emsp;&emsp;
        {<br/>&emsp;&emsp;&emsp;
            type : "INTEGER",<br/>&emsp;&emsp;&emsp;
            name : "field_name1",<br/>&emsp;&emsp;&emsp;
            value : 3300<br/>&emsp;&emsp;
        },<br/>&emsp;&emsp;
        {<br/>&emsp;&emsp;&emsp;
            type : "FLOAT",<br/>&emsp;&emsp;&emsp;
            name : "field_name2",<br/>&emsp;&emsp;&emsp;
            value : 8.0<br/>&emsp;&emsp;
        },<br/>&emsp;&emsp;
        {<br/>&emsp;&emsp;&emsp;
            type : "STRING",<br/>&emsp;&emsp;&emsp;
            name : "field_name3",<br/>&emsp;&emsp;&emsp;
            value : "what?"<br/>&emsp;&emsp;
        }<br/>
    ]<br/><br/><br/>

    <b>Update data:</b><br/>
    https://candy-smith.info:3636/api/update?api_key=348t7hre48eruif78e74g4&player_id=123456&table=tablename<br/><br/>
    <span style="color: rgb(28, 143, 85);">Блоки данных SET и WHERE, SQL запроса UPDATE:</span><br/>
    {<br/>&emsp;
        set :<br/>&emsp;&emsp;
        [<br/>&emsp;&emsp;&emsp;
            {<br/>&emsp;&emsp;&emsp;&emsp;
                type : "INTEGER",<br/>&emsp;&emsp;&emsp;&emsp;
                name : "field_name1",<br/>&emsp;&emsp;&emsp;&emsp;
                value : 3050<br/>&emsp;&emsp;&emsp;
            },<br/>&emsp;&emsp;&emsp;
            {<br/>&emsp;&emsp;&emsp;&emsp;
                type : "FLOAT",<br/>&emsp;&emsp;&emsp;&emsp;
                name : "field_name2",<br/>&emsp;&emsp;&emsp;&emsp;
                value : 7.55<br/>&emsp;&emsp;&emsp;
            },<br/>&emsp;&emsp;&emsp;
            {<br/>&emsp;&emsp;&emsp;&emsp;
                type : "STRING",<br/>&emsp;&emsp;&emsp;&emsp;
                name : "field_name3",<br/>&emsp;&emsp;&emsp;&emsp;
                value : "hahaha"<br/>&emsp;&emsp;&emsp;
            }<br/>&emsp;&emsp;
        ],<br/>&emsp;
        where :<br/>&emsp;&emsp;
        [<br/>&emsp;&emsp;&emsp;
            {<br/>&emsp;&emsp;&emsp;&emsp;
                type : "INTEGER",<br/>&emsp;&emsp;&emsp;&emsp;
                name : "field_name1",<br/>&emsp;&emsp;&emsp;&emsp;
                value : 3300<br/>&emsp;&emsp;&emsp;
            },<br/>&emsp;&emsp;&emsp;
            {<br/>&emsp;&emsp;&emsp;&emsp;
                type : "FLOAT",<br/>&emsp;&emsp;&emsp;&emsp;
                name : "field_name2",<br/>&emsp;&emsp;&emsp;&emsp;
                value : 8.0<br/>&emsp;&emsp;&emsp;
            },<br/>&emsp;&emsp;&emsp;
            {<br/>&emsp;&emsp;&emsp;&emsp;
                type : "STRING",<br/>&emsp;&emsp;&emsp;&emsp;
                name : "field_name3",<br/>&emsp;&emsp;&emsp;&emsp;
                value : "what?"<br/>&emsp;&emsp;&emsp;
            }<br/>&emsp;&emsp;
        ]<br/>
    }<br/><br/><br/>
    <script>
            function sendAjax(url, postData) {
                /*$.post(url, postData, 
                    function(returnedData){
                        console.log(returnedData);
                        $("#response-area").text(returnedData);
                });*/
                //alert(JSON.stringify(postData));
                $("#response-area").text("Wait response");
                $.ajax({
                    url: url,
                    type: "POST",
                    crossDomain: true,
                    data: postData,
                    //dataType: "json",
                    success: function (response) {
                        //var resp = JSON.parse(response)
                        //alert(resp.status);
                        //console.log(response);
                        $("#response-area").text(JSON.stringify(response));
                    },
                    error: function (xhr, status) {
                        $("#response-area").text("Error status: \""+status+"\"");
                    }
                });
            }
    
            $('#gen-api-key').on('click', function() {
                sendAjax($("#host").val()+":"+$("#port").val()+"/system/generate_api_key?email="+$('#owner-email').val(), {});
            });
    
            $('#reg-game').on('click', function() {
                sendAjax($("#host").val()+":"+$("#port").val()+"/system/register_game", "api_key="+$('.reg-game-area .api-key-field').val()+ 
                                                                                         "&game_name="+$('.reg-game-area .game-name-field').val()+ 
                                                                                         "&game_package="+$('.reg-game-area .game-package-field').val()+ 
                                                                                         "&game_type="+$('.reg-game-area .game-type-field').val());
            });
    
            $('#del-game').on('click', function() {
                sendAjax($("#host").val()+":"+$("#port").val()+"/system/delete_game?api_key="+$('.area-of-delete-game .api-key-field').val(), {});
            });
    
            $('#insert').on('click', function() {
                var request = "/api/insert?api_key="+$('.area-of-insert .api-key-field').val()+"&table="+$('.area-of-insert .table-field').val();

                if($('#update-if-exists').is(':checked') && $("#check-fields").val().trim().length > 0) {
                    request += "&updateIfExists=true";
                    var fields = $("#check-fields").val().trim().split(",");
                    fields.forEach(function(el, i) {
                        request += "&checkField"+(i+1)+"="+el;
                    });
                }

                sendAjax($("#host").val()+":"+$("#port").val()+request, 
                JSON.stringify(dataToJson($('.area-of-insert .data-field').val())));
            });
    
            $('#update-if-exists').on('click', function() {
                if($(this).is(':checked')) {
                    $("#check-fields-label").show();
                } else {
                    $("#check-fields-label").hide();
                }
            });
    
            $('#select').on('click', function() {
                sendAjax($("#host").val()+":"+$("#port").val()+"/api/select?api_key="+$('.area-of-select .api-key-field').val()+"&table="+$('.area-of-select .table-field').val(), 
                JSON.stringify(dataToJson($('.area-of-select .data-field').val())));
            });
    
            $('#update').on('click', function() {
                sendAjax($("#host").val()+":"+$("#port").val()+"/api/update?api_key="+$('.area-of-update .api-key-field').val()+"&table="+$('.area-of-update .table-field').val(), 
                JSON.stringify({set : dataToJson($('.area-of-update .data-field').val()), where : dataToJson($('.area-of-update .where-field').val())}));
            });

            function dataToJson(data) {
                var result = [];
                if(data.includes("&")) {
                    var array1 = data.split("&");
                    array1.forEach(function(item) {
                        var array2 = item.split("=");
                        result.push({name : array2[0], value : array2[1]});
                    });
                } else if(data.includes("="))  {
                    var array2 = data.split("=");
                    result.push({name : array2[0], value : array2[1]});
                }
                
              return result;  
            }

            $('.clear-fields').on('click', function() {
                var parent = $(this).parent();
                $('input[type=text]', parent).val("");
            });

            $('#fill-test-data').on('click', function() {
                var parent = $(this).parent();
                $('input.game-name-field', parent).val("Magic Forest");
                $('input.game-package-field', parent).val("com.magicgames.magicforest");
                $('input.game-type-field', parent).val("quest");
            });
        </script>
</body>
</html>