<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Test Form</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <style>
        input[type='text'] {
            margin-left: 6px;
            margin-right: 6px;
            margin-bottom: 6px;
            width: 137px;
        }
        input[type='text'].api-key-field, input[type='text'].api-secret-field {
            width:322px;
        }
        input[type='button'] {
            margin-bottom: 6px;
            margin-right: 6px;
        }
        .desc {
            font-size: 10pt;
            color: rgb(167, 167, 167);
            font-style: italic;
        }
        .code-block {
            padding: 5px;
            background-color: #e6e3e3;
            border: solid 2px #a2a2a2;
            border-radius: 6px;
            margin-top: 5px;
            margin-bottom: 20px;
        }

        .reg-game-area input[type="button"] {
            margin-left: 105px;
            width: 105px;
        }

        .reg-game-area input[type="text"] {
            width: 250px;
        }

        .area-of-select input[type="button"] {
            margin-left: 63px;
            width: 90px;
        }

        .area-of-update input[type="button"] {
            margin-left: 63px;
            width: 90px;
        }
        .area-of-insert input[type="button"] {
            margin-left: 62px;
            
            width: 90px;
        }
        label {
            display: inline-block;
            width: 100px;
            text-align: right;
        }
        .server-area label {
            width: 36px;
        }
        .gen-api-area label {
            width: 46px;
        }
        .gen-api-area input[type="button"] {
            margin-left: 49px;
        }
        .game-secr-area input[type="button"] {
            margin-left: 77px;
        }
        .area-of-delete-game label {
            width: 60px;
        }
        .area-of-select label, .area-of-insert label, .area-of-update label {
            width: 58px;
        }

        .area-of-insert #update-if-exists {
            margin-left: 65px;
            margin-bottom: 11px;
        }

        .area-of-insert-mod1 label {
            width: 85px;
        }

        .area-of-insert-mod1 #update-if-exists  {
            margin-left: 92px;
        }

        #response-area {
            width: 1035px;
        }

        .content {
            margin-left: auto;
            margin-right: auto;
            width: 1045px;
        }

        .game-secr-area label {
            width: 72px;
        }

        .temp-grid {
            display: grid; 
            grid-template-columns: repeat(10, 116px); 
            grid-auto-rows: minmax(100px, auto);
        }

        .server-area {
            grid-column-start: 1; 
            grid-column-end: 3; 
        }

        .gen-api-area {
            grid-column-start: 3; 
            grid-column-end: 6; 
        }

        .game-secr-area {
            grid-column-start: 6; 
            grid-column-end: 10; 
        }

        .player-auth-area {
            grid-row-start: 2; 
            grid-row-end: 3; 
            grid-column-start: 1; 
            grid-column-end: 10; 
        }

        .reg-game-area {
            grid-row-start: 3; 
            grid-row-end: 4; 
            grid-column-start: 1; 
            grid-column-end: 6; 
        }

        .area-of-select {
            grid-row-start: 3; 
            grid-row-end: 4; 
            grid-column-start: 6; 
            grid-column-end: 10; 
        }

        .area-of-insert {
            grid-row-start: 4; 
            grid-row-end: 5; 
            grid-column-start: 1; 
            grid-column-end: 5; 
        }

        .area-of-update {
            grid-row-start: 4; 
            grid-row-end: 5; 
            grid-column-start: 5; 
            grid-column-end: 10; 
        }

        .set-spec-req-area {
            grid-row-start: 5; 
            grid-row-end: 6; 
            grid-column-start: 1; 
            grid-column-end: 6; 
        }

        .spec-request-area {
            grid-row-start: 5; 
            grid-row-end: 6; 
            grid-column-start: 6; 
            grid-column-end: 10; 
        }

        .spec-requests-list {
            grid-row-start: 6; 
            grid-row-end: 7; 
            grid-column-start: 1; 
            grid-column-end: 6; 
        }
    </style>
</head>
<body>
    <div class="content">
        <form>
        <div class="temp-grid">

        <fieldset class="form-area server-area">
            <legend>Server</legend>
            <label>Host:</label><input id="host" type="text" value="http://"/><br/>
            <label>Port:</label><input id="port" type="text"/><br/>
        </fieldset>
        
        <fieldset class="form-area gen-api-area">
            <legend>Generate API key / Register owner</legend>
            <label>e-mail:</label><input style="width: 250px;" id="owner-email" type="text"/><br/>
            <input id="gen-api-key" type="button" value="Generate API key"/>
        </fieldset>

        <fieldset class="form-area game-secr-area">
            <legend>Game secrets</legend>
            <label>API key:</label><input class="api-key-field" type="text"/><br/>
            <label>Secret:</label><input class="api-secret-field" type="text"/><br/>
            <input id="del-game" type="button" value="Delete game" disabled/>
        </fieldset>

        <fieldset class="form-area player-auth-area">
            <legend>Player Facebook authorization</legend>
            <label>Facebook id:</label><input class="player-facebookid-field" type="text"/><br/>
            <input id="player-auth" type="button" value="Do it"/>
            <span>Status: <span id="auth-status">Not authorized</span></span>
        </fieldset>

        <fieldset class="form-area reg-game-area">
            <legend>Register game</legend>
            <label>Game name:</label><input class="game-name-field" type="text"/><br/>
            <label>Game package:</label><input class="game-package-field" type="text"/><br/>
            <label>Game type:</label><input class="game-type-field" type="text"/><br/>
            <input id="fill-test-data" type="button" value="Fill test data"/><br/>
            <input id="reg-game" type="button" value="Register game"/><span class="desc">Register game and create tables "players", "levels", "boosts"</span><br/>
            <input class="clear-fields" type="button" value="Clear fileds"/>
        </fieldset>

        <fieldset class="form-area area-of-select">
            <legend>Select data</legend>
            <label>Table:</label><input class="table-field" type="text"/><br/>
            <label>Where:</label><input class="data-field" type="text"/><span class="desc">param1=valueA&amp;param2=valueB</span><br/>
            <input id="select" type="button" value="Request"/><br/>
            <input class="clear-fields" type="button" value="Clear fileds"/>
        </fieldset>

        <fieldset class="form-area area-of-insert">
            <legend>Insert data</legend>
            <label>Table:</label><input class="table-field" type="text"/><br/>
            <label>Insert exp:</label><input class="data-field" type="text"/><span class="desc">param1=valueA&amp;param2=valueB</span><br/>
            <!--<input id="update-if-exists" type="checkbox" value=""/>Update if exists
            <span style="display:none" id="check-fields-label"><br/><label>If fields equals:</label><input id="check-fields" type="text"/><span class="desc">fieldName1,fieldName2,fieldName3</span></span><br/>-->
            <label>Where cond:</label><input class="where-cond" type="text"/><span class="desc">param1=valueA&amp;param2=valueB</span><br/>
            <input id="insert" type="button" value="Send"/><br/>
            <input class="clear-fields" type="button" value="Clear fileds"/>
        </fieldset>

        <fieldset class="form-area area-of-update">
            <legend>Update data</legend>
            <label>Table:</label><input class="table-field" type="text"/><br/>
            <label>Set:</label><input class="data-field" type="text"/><span class="desc">param1=valueA&amp;param2=valueB</span><br/>
            <label>Where:</label><input class="where-field" type="text"/><span class="desc">param1=valueA&amp;param2=valueB</span><br/>
            <input id="update" type="button" value="Send"/><br/>
            <input class="clear-fields" type="button" value="Clear fileds"/>
        </fieldset>

        <fieldset class="form-area set-spec-req-area">
            <legend>Set special request</legend>
            <label>Name:</label><input class="spec-req-name" type="text"/><br/>
            <label>Table:</label><input class="spec-req-table" type="text"/><br/>
            <label>Fields:</label><input class="spec-req-fields-set" type="text"/><span class="desc">field1,field2,... or * to select all</span><br/>
            <input id="submit-spec-req" type="button" value="Submit"/><br/>
            <input class="clear-fields" type="button" value="Clear fileds"/>
        </fieldset>

        <fieldset class="form-area spec-request-area">
            <legend>Special request</legend>
            <label>Name:</label><input class="spec-req-name" type="text"/><br/>
            <label>Where:</label><input class="where-field" type="text"/><span class="desc">param1=valueA&amp;param2=valueB</span><br/>
            <input id="send-spec-req" type="button" value="Submit"/><br/>
            <input id="spec-req" class="clear-fields" type="button" value="Clear fileds"/>
        </fieldset>

        <fieldset class="form-area spec-requests-list">
            <legend>Special requests list</legend>
            <input id="req-spec-list" type="button" value="Get list"/><br/>
        </fieldset>

        </div>

        <div style="margin-top: 12px; margin-bottom: 12px;">
            <label style="width: 80px;">Response:</label><br/><textarea name="" id="response-area" cols="30" rows="10"></textarea>
        </div>

        </form>
        <h2>Документация API на основе web-клиента test-form.html</h2>
        <p>В общем виде url запроса имеет следующий вид:</p>
        <p><b>https://address:port/request_group/request_name</b></p>
        <p>Сущесствует 4 вида request_group:</p>
        <ul>
            <li><b>system</b> - группа запросов владельца, в неё входят действия над играми от лица владельца (добавление/изменение) а так же регистрация нового владельца. В веб клиенте доступны лиш функции регистрации нового владельца, генерация новых ключей, и добавление на основе этих ключей новых игр. Все эти функции будут удалены из API в будущем, потомучто эти действия будут выполняться на сайте.</li>
            <li><b>player</b> - группа запросов, пока что связаная только с авторизацией игрока и содержит единственный запрос <b>authorization</b>, который выполняет авторизацию игрока по facebookId. Данный запрос возвращает playerId из базы данных. В будущем будет возвращать authorization token.</li>
            <li><b>api</b> - группа запросов для выборки/вставки/обновления данных из конкретной таблицы</li>
            <li><b>special</b> - группа для кастомных запросов. Владелец игры может создавать специальные запросы для своей игры</li>
        </ul>
        <p>Список всех групп и запросов:</p>
        <p>
            /system/generate_api_key</br>
            /system/register_game</br>
            /system/special_request_list</br></br>
            /player/authorization</br></br>
            /api/insert</br>
            /api/select</br>
            /api/update</br></br>
            /special/*
        </p>
        <p>Первым важным моментом является то что группа api будет недоступна без авторизации пользователя. Сначала нужно выполнить запрос /player/authorization, который возвращает нужный идентификатор пользователя</p>
        <p>Вторым важным моментом является понимание того как работают запросы к данным из группы api. Чтобы обеспечить безопасность и сделать невозможным получение или изменение чужих данных, все запросы этой группы ограничиваются данными текущего пользователя. Это ограничение будет работать если сохранять некоторые правла структуры для новых таблиц. Это правило говорит о том что каждая строка таблицы и все данные в ней относятся только к одному пользователю и все эти таблицы имеют столбец playerId который уникально определяет пользователя. Имя данного столбца можно определить своё для каждой игры, в общих настройках.</p>
        <p>Другими словами, после авторизации и получения ID пользователя, вы можете выполнять запросы из группы api. Выбрав данные с помощью select и указав имя таблицы, вы получите только те данные, которые вам предназначены как авторизованному пользователю. Не смотря на то, указали ли вы условие выборки данных, вам всегда будут возвращаться данные связаные с вашим пользователем. Условия выборки влияют на уже выбраный для вас набор данных.</p>
        <p>Третий момент связан с группой special. Чтобы расширить огранияения, связаные с безопасностью, была введена группа special для владельцев, которые хотят чтобы их запросы выбирали больше данных, чем это позволяет группа api. Например это может быть нужно для вывода leaderboard. В панели управления владелей может сам создать special запрос, присвоить ему своё имя, указать таблицу, к которой будет обращаться запрос, и набор полей, который он будет возвращать, а так же дополнительные условия для выборки.</p>
        <b>Generate API key / Register owner:</b><br/>
        <div class="code-block">
        /system/generate_api_key<br/><br/>
        <b>email</b>=fake@fake.net
        </div>
        
        <b>Register game:</b><br/>
        <div class="code-block">
        /system/register_game<br/><br/>
        <b>api_key</b>=348t7hre48eruif78e74g4&<b>game_name</b>=Magic Forest&<b>game_package</b>=com.magicgames.magicforest&<b>game_type</b>=assetname
        </div>
        
        <b>Delete game:</b><br/>
        <div class="code-block">
        /system/delete_game?<b>api_key</b>=348t7hre48eruif78e74g4
        </div>
        
        <b>Insert data:</b><br/>
        <div class="code-block">
        /api/insert?<b>api_key</b>=348t7hre48eruif78e74g4&<b>table</b>=tablename<br/><br/>
        
        [<br/>&emsp;
        [<br/>&emsp;&emsp;
        {<br/>&emsp;&emsp;&emsp;
        type : "INTEGER",<span style="color: rgb(28, 143, 85);">&emsp;&emsp;&emsp;&emsp;&lt;-- Параметр <b>type</b> не обязательный, так как работает автоматическое приведение типов</span><br/>&emsp;&emsp;&emsp;
        name : "field_name1",<br/>&emsp;&emsp;&emsp;
        value : 3050<br/>&emsp;&emsp;
        },<br/>&emsp;&emsp;
        {<br/>&emsp;&emsp;&emsp;
        type : "FLOAT",<br/>&emsp;&emsp;&emsp;
        name : "field_name2",<br/>&emsp;&emsp;&emsp;
        value : 7.55<br/>&emsp;&emsp;
        },<br/>&emsp;&emsp;
        {<br/>&emsp;&emsp;&emsp;
        type : "STRING",<br/>&emsp;&emsp;&emsp;
        name : "field_name3",<br/>&emsp;&emsp;&emsp;
        value : "hahaha"<br/>&emsp;&emsp;
        }<br/>&emsp;
        ],<br/>&emsp;
        [<br/>&emsp;&emsp;
        {<br/>&emsp;&emsp;&emsp;
        type : "INTEGER",<br/>&emsp;&emsp;&emsp;
        name : "field_name1",<br/>&emsp;&emsp;&emsp;
        value : 3300<br/>&emsp;&emsp;
        },<br/>&emsp;&emsp;
        {<br/>&emsp;&emsp;&emsp;
        type : "FLOAT",<br/>&emsp;&emsp;&emsp;
        name : "field_name2",<br/>&emsp;&emsp;&emsp;
        value : 8.0<br/>&emsp;&emsp;
        },<br/>&emsp;&emsp;
        {<br/>&emsp;&emsp;&emsp;
        type : "STRING",<br/>&emsp;&emsp;&emsp;
        name : "field_name3",<br/>&emsp;&emsp;&emsp;
        value : "what?"<br/>&emsp;&emsp;
        }<br/>&emsp;
        ]<br/>
        ]
        </div>
        
        <b>Insert data or update if exists:</b><br/>
        
        <div class="code-block">
            /api/insert?<b>api_key</b>=348t7hre48eruif78e74g4&<b>table</b>=tablename&<b>checkAndUpdate</b>=field_name1,field_name2<br/><br/>
            <json-block>
                [{type : "INTEGER",name : "field_name1",value : 3050},{type : "FLOAT",name : "field_name2",value : 7.55},{type : "STRING",name : "field_name3",value : "hahaha"}]
            </json-block>
        </div>
        
        <b>Select data:</b><br/>
        <div class="code-block">
            /api/select?<b>api_key</b>=348t7hre48eruif78e74g4&<b>table</b>=tablename<br/><br/>
            <span style="color: rgb(28, 143, 85);">Объеденяется с помощью AND</span><br/>
            <json-block>
            [{
                type : "INTEGER",
                name : "field_name1",
                value : 3300
            },{
                type : "FLOAT",
                name : "field_name2",
                value : 8.0
            },{
                type : "STRING",
                name : "field_name3",
                value : "what?"
            }]
            </json-block>
        </div>
        
        <b>Update data:</b><br/>
        <div class="code-block">
            /api/update?<b>api_key</b>=348t7hre48eruif78e74g4&<b>table</b>=tablename<br/><br/>
            <span style="color: rgb(28, 143, 85);">Блоки данных SET и WHERE, SQL запроса UPDATE:</span><br/>
            <json-block>
            { set :
                [{
                    type : "INTEGER",
                    name : "field_name1",
                    value : 3050
                },{
                    type : "FLOAT",
                    name : "field_name2",
                    value : 7.55
                },{
                    type : "STRING",
                    name : "field_name3",
                    value : "hahaha"
                }],
              where :
                [{
                    type : "INTEGER",
                    name : "field_name1",
                    value : 3300
                },{
                    type : "FLOAT",
                    name : "field_name2",
                    value : 8.0
                },{
                    type : "STRING",
                    name : "field_name3",
                    value : "what?"
                }]
            }
            </json-block>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/hmac-sha256.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/enc-base64.min.js"></script>
    <script>
            let playerId = "";

            function apiRequestHeaders(uri, apiKey, apiSecret) {
                return { Authorization : generateHmac(uri, apiKey, apiSecret), Player_id : playerId };
            }

            function sendAjax(host, uri, postData, additionalHeaders, success) {
                $("#response-area").text("Wait response");

                let commonSuccess = function (response) {
                        $("#response-area").text(JSON.stringify(response));
                    }
                
                $.ajax({
                    url: host+uri,
                    type: "POST",
                    crossDomain: true,
                    data: postData,
                    success: success==undefined?commonSuccess:success,
                    error: function (xhr, status) {
                        $("#response-area").text("Error status: \""+status+"\"");
                    },
                    beforeSend: function(request) {
                        $.each(additionalHeaders, function(index, value) {
                            request.setRequestHeader(index, value);
                        }); 
                    }
                });
            }

            function generateHmac(uri, apiKey, apiSecret) {
                let gameHash = CryptoJS.HmacSHA256(apiKey, apiSecret);
                let b64GameHash = CryptoJS.enc.Base64.stringify(gameHash);
                let requestHash = CryptoJS.HmacSHA256(b64GameHash.substring(0, 8)+uri, b64GameHash);
                let b64RequestHash = CryptoJS.enc.Base64.stringify(requestHash);
                return b64RequestHash+':'+b64GameHash;
            }
    
            $('#player-auth').on('click', function() {
                let onSuccess = function (response) {
                    $("#response-area").text(JSON.stringify(response));
                    if(response.hasOwnProperty('playerId')) {
                        playerId = response.playerId;
                        if(playerId != undefined) {
                            $('#auth-status').text("Authorized");
                        }
                    }
                }
                let uri = "/player/authorization";
                sendAjax($("#host").val()+":"+$("#port").val(), uri, "facebookId="+$(".player-facebookid-field").val(), apiRequestHeaders(uri, $('.api-key-field').val(), $('.api-secret-field').val()), onSuccess);
            });
    
            $('#gen-api-key').on('click', function() {
                sendAjax($("#host").val()+":"+$("#port").val(), "/system/generate_api_key", "email="+$('#owner-email').val(), {});
            });
    
            $('#reg-game').on('click', function() {
                sendAjax($("#host").val()+":"+$("#port").val(), "/system/register_game", "api_key="+$('.api-key-field').val()+"&game_name="+$('.reg-game-area .game-name-field').val()+ 
                                                                                         "&game_package="+$('.reg-game-area .game-package-field').val()+ 
                                                                                         "&game_type="+$('.reg-game-area .game-type-field').val(), $('.api-key-field').val(), {});
            });
    
            /*$('#del-game').on('click', function() {
                ownerRequest($("#host").val()+":"+$("#port").val()+"/system/delete_game", {}, $('.api-key-field').val());
            });*/
    
            $('#insert').on('click', function() {

                let uri = "/api/insert?table="+$('.area-of-insert .table-field').val();

                let insertData = literalToJson($('.area-of-insert .data-field').val());
                let whereData = literalToJson($('.area-of-insert .where-cond').val().trim());
                let requestContent = JSON.stringify({insert_data : insertData});

                if(whereData.length > 0) {
                    uri += "&updateIfExists=true";
                    requestContent = JSON.stringify({insert_data : insertData, where_condition : whereData});
                }

                sendAjax($("#host").val()+":"+$("#port").val(), 
                uri, 
                requestContent, 
                apiRequestHeaders(uri, $('.api-key-field').val(), $('.api-secret-field').val()));
            });
    
            $('#select').on('click', function() {
                let uri = "/api/select?table="+$('.area-of-select .table-field').val();
                sendAjax($("#host").val()+":"+$("#port").val(), 
                uri, 
                JSON.stringify(literalToJson($('.area-of-select .data-field').val())), 
                apiRequestHeaders(uri, $('.api-key-field').val(), $('.api-secret-field').val()));
            });
    
            $('#update').on('click', function() {
                let uri = "/api/update?table="+$('.area-of-update .table-field').val();
                sendAjax($("#host").val()+":"+$("#port").val(), 
                uri, 
                JSON.stringify({set : literalToJson($('.area-of-update .data-field').val()), where : literalToJson($('.area-of-update .where-field').val())}), 
                apiRequestHeaders(uri, $('.api-key-field').val(), $('.api-secret-field').val()));
            });
    
            $('#submit-spec-req').on('click', function() {
                let uri = "/system/set_special_request";
                sendAjax($("#host").val()+":"+$("#port").val(), 
                uri, 
                "request_name="+$(".set-spec-req-area .spec-req-name").val()+"&query_table="+$(".spec-req-table").val()+"&fields_set="+$(".spec-req-fields-set").val(), 
                apiRequestHeaders(uri, $('.api-key-field').val(), $('.api-secret-field').val()));
            });
    
            $('#send-spec-req').on('click', function() {
                let uri = "/special/"+$(".spec-request-area .spec-req-name").val();
                sendAjax($("#host").val()+":"+$("#port").val(), 
                uri, 
                JSON.stringify(literalToJson($('.spec-request-area .where-field').val())), 
                apiRequestHeaders(uri, $('.api-key-field').val(), $('.api-secret-field').val()));
            });

            $('#req-spec-list').on('click', function() {
                let uri = "/system/special_request_list";
                sendAjax($("#host").val()+":"+$("#port").val(), 
                uri, 
                "", 
                apiRequestHeaders(uri, $('.api-key-field').val(), $('.api-secret-field').val()));
            });

            function literalToJson(data) {
                let result = [];
                if(data.includes("&")) {
                    let array1 = data.split("&");
                    array1.forEach(function(item) {
                        let array2 = item.split("=");
                        if(array2.length >= 2) {
                            let value = array2[1];
                            if(value.startsWith('[')) {
                                value = JSON.parse(value);
                            }
                            result.push({name : array2[0], value : value});
                        }
                    });
                } else if(data.includes("="))  {
                    let array2 = data.split("=");
                    if(array2.length >= 2) {
                        let value = array2[1];
                        if(value.startsWith('[')) {
                            value = JSON.parse(value);
                        }
                        result.push({name : array2[0], value : value});
                    }
                }
                
              return result;  
            }

            $('.clear-fields').on('click', function() {
                let parent = $(this).parent();
                $('input[type=text]', parent).val("");
            });

            $('#fill-test-data').on('click', function() {
                let parent = $(this).parent();
                $('input.game-name-field', parent).val("Magic Forest");
                $('input.game-package-field', parent).val("com.magicgames.magicforest");
                $('input.game-type-field', parent).val("quest");
            });

            function prettyJson(jsonCode) {
                jsonCode = jsonCode.trim();
                let indentSize = 0;
                for (let i = 0; i < jsonCode.length; i++) {
                    
                    let ch = jsonCode.charAt(i);
                    let trigger = indentSize;
                    let breakIndex = i;

                    if(ch == '{' || ch == '[') {
                        indentSize++;
                        breakIndex++;
                    } else if(ch == '}' || ch == ']') {
                        indentSize--;
                    } else if(ch == ',') {
                        breakIndex++;
                    }

                    if(indentSize < 0) indentSize = 0;

                    if(trigger != indentSize || breakIndex != i) {
                        let indentValue = '';
                        for (let j = 0; j < indentSize; j++) {
                            indentValue += '&emsp;';
                        }
                        jsonCode = jsonCode.substring(0, breakIndex) + "<br/>" + indentValue + jsonCode.substring(breakIndex, jsonCode.length);
                        i+=indentValue.length+5;
                    }
                }

                return jsonCode;
            }
            
            let jsonBlocks = document.getElementsByTagName('json-block');
            for (let i = 0; i < jsonBlocks.length; i++) {
                jsonBlocks[i].innerHTML = prettyJson(jsonBlocks[i].innerHTML);
            }
        </script>
</body>
</html>